#! /bin/sh
# run_serve

usage() {
	echo "Usage: $0 [-br]"
	echo
	exit 1
}

push_assets() {
	npm run build
	rsync -avz -I --delete public/build/ $SSH_SERVER:csdha/public/build/
	rsync -avz -I --delete resources/pdf/images/ $SSH_SERVER:csdha/resources/pdf/images/
	rsync -avz -I --delete resources/pdf/fonts/ $SSH_SERVER:csdha/resources/pdf/fonts/
	rsync -avz -I container/apache/main-site.conf $SSH_SERVER:csdha/container/apache/main-site.conf
}

while getopts "b" opt; do
	case $opt in
		b) push_assets ;;
		*) usage ;;
	esac
done

ssh $SSH_SERVER 'cd csdha && git pull && bash ./serve'

