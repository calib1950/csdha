#! /bin/sh
# serve

export DOCKER_HOST=unix:///run/user/$UID/podman/podman.sock
export PODMAN_COMPOSE_WARNING_LOGS=false
export PODMAN_COMPOSE_PROVIDER=podman-compose

if [ -d "$HOME/bin" ] ; then
	PATH="$HOME/bin:$PATH"
fi

if [ -d "$HOME/.local/bin" ] ; then
	PATH="$HOME/.local/bin:$PATH"
fi

usage() {
	echo "Usage: $0 []"
	echo
	exit 1
}

while getopts "" opt; do
	case $opt in
		*) usage ;;
	esac
done

if [ "$(docker-compose ps -q)" ]; then
	podman compose build && \
	docker-compose rm -sf web-user web-admin && \
	podman image prune -f && \
	docker-compose up -d web-user web-admin
else
	docker-compose up -d
fi

