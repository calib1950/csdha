#! /bin/sh
# serve

export DOCKER_HOST=unix:///run/user/$UID/podman/podman.sock

docker-compose() {
	$HOME/.local/bin/docker-compose $@
}

usage() {
	echo "Usage: $0 []"
	echo
	exit 1
}

while getopts "" opt; do
	case $opt in
		*) usage ;;
	esac
done

git pull

if [ "$(docker-compose ps -q)" ]; then
	podman compose build && \
	docker-compose rm -sf web-user web-admin && \
	podman image prune -f && \
	docker-compose up -d web-user web-admin
else
	docker-compose up -d
fi

